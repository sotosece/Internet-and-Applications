<!DOCTYPE HTML>
<html>
<head>
    <title>You first Spring application</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script>
        function refreshTable(tableId, selectId, select2Id, inputId) {
            var table = document.getElementById(tableId);
            var from = document.getElementById(selectId).value;
            var url = "exchange?from=" + from;
            if (select2Id != null && inputId != null) {
                var to = $('#'+select2Id).val();
                console.log(to);
                var amount = document.getElementById(inputId).value;
                url += "&to=" + to + "&amount=" + amount;
            }
            console.log(from);
            table.innerHTML = null;
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText);
                    var objects = JSON.parse(this.responseText);
                    objects.forEach( element => {
                            var row = table.insertRow(0);
                            //var cell0 = row.insertCell(0);
                            var cell1 = row.insertCell(0);
                            var cell2 = row.insertCell(1);
                            //cell0.innerHTML = element.from;
                            cell1.innerHTML = element.to;
                            cell2.innerHTML = element.exchangeAmount;
                    });
                }
            };
            xhttp.open("GET", url, true);
            xhttp.send();
        };
        function setSelectLists(){
            var select1 = document.getElementById("select1");
            var select2 = document.getElementById("select2");
            var select3 = document.getElementById("select3");
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    console.log(this.responseText);
                    var objects = JSON.parse(this.responseText);
                    objects.forEach( element => {
                        var option1 = document.createElement("option");
                        var option2 = document.createElement("option");
                        var option3 = document.createElement("option");
                        option1.text = element;
                        option2.text = element;
                        option3.text = element;
                        option1.value = element;
                        option2.value = element;
                        option3.value = element;
                        select1.add(option1);
                        select2.add(option2);
                        select3.add(option3);
                    });
                    select1.value = "EUR";
                    select2.value = "EUR";
                    select3.value = "EUR";
                    refreshTable("table1", "select1", null, null);
                }
            };
            xhttp.open("GET", "currencies", true);
            xhttp.send();
        };
    </script>
</head>
<body onload="setSelectLists();">
<div style="display: inline">
    <div style="width:50%; height:100%; display: inline-block; float:left;">
        <select id="select1"></select>
        <button onclick="refreshTable('table1', 'select1', null)">Refresh</button>
        <table id="table1"></table>
    </div>
    <div style="width: 50%; height:100%; display: inline-block;">
        <select id="select2"></select>
        <select id="select3" multiple></select>
        <input id='input1' type="number" min="0.00" step="0.01" />
        <button onclick="refreshTable('table2', 'select2', 'select3', 'input1')">Calculate</button>
        <table id="table2"></table>
    </div>
</div>
</body>
</html>
